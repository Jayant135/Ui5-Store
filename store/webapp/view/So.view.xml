<mvc:View
    controllerName="store.controller.So"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
>
    <Page title="Sales Orders">
        <Panel class="sapUiSmallMargin">
            <headerToolbar>
                <OverflowToolbar>
                    <Title
                        text="Sales Orders"
                        level="H2"
                    />
                    <ToolbarSpacer width="75%" />

                    <Button
                        icon="sap-icon://add"
                        text="Create"
                        type="Emphasized"
                        press="onCreateSO"
                    />

                    <Button
                        icon="sap-icon://edit"
                        text="Edit"
                        enabled="{= ${so>/selectedSO} !== null }"
                        press="onEditSO"
                    />

                    <Button
                        icon="sap-icon://delete"
                        text="Delete"
                        type="Negative"
                        enabled="{= ${so>/selectedSO} !== null }"
                        press="onDeleteSO"
                    />
                </OverflowToolbar>
            </headerToolbar>

            <Table
                items="{so>/soList}"
                mode="SingleSelectMaster"
                selectionChange="onSOSelect"
                alternateRowColors="true"
            >
                <columns>
                    <Column>
                        <Text text="SO No" />
                    </Column>
                    <Column>
                        <Text text="Date" />
                    </Column>
                    <Column>
                        <Text text="Customer" />
                    </Column>
                    <Column hAlign="Center">
                        <Text text="Amount" />
                    </Column>
                    <Column width="3rem" />
                </columns>

                <items>
                    <ColumnListItem>
                        <cells>
                            <Text text="{so>soNumber}" />
                            <Text text="{so>soDate}" />
                            <Text text="{so>customer}" />
                            <ObjectNumber
                                number="{so>totalAmount}"
                                unit="₹"
                            />
                            <Button
                                icon="sap-icon://inspection"
                                type="Transparent"
                                press="onShowSODetails"
                            />
                        </cells>
                    </ColumnListItem>
                </items>
            </Table>
        </Panel>

        <!-- CREATE / EDIT DIALOG -->
        <Dialog
            id="soDialog"
            title="{= ${so>/mode} === 'EDIT' ? 'Edit Sales Order' : 'Create Sales Order' }"
            contentWidth="700px"
            draggable="true"
        >
            <VBox class="sapUiMediumMargin">
                <ObjectHeader
                    title="{so>/currentSO/soNumber}"
                    number="{so>/currentSO/totalAmount}"
                    numberUnit="₹"
                />

                <Label text="Customer" />
                <Input value="{so>/currentSO/customer}" />

                <Label text="Category" />
                <Select
                    items="{so>/categories}"
                    change="onCategoryChange"
                >
                    <items>
                        <core:Item
                            key="{so>}"
                            text="{so>}"
                        />
                    </items>
                </Select>

                <Label text="Item" />
                <ComboBox
                    id="soItemSelect"
                    items="{so>/items}"
                    selectionChange="onItemSelect"
                >
                    <items>
                        <core:Item
                            key="{so>id}"
                            text="{so>name}"
                        />
                    </items>
                </ComboBox>

                <Label text="Quantity" />
                <Input
                    id="soQtyInput"
                    type="Number"
                />

                <Button
                    icon="sap-icon://add"
                    text="Add Item"
                    press="onAddItem"
                />

                <Table
                    items="{so>/currentSO/items}"
                    class="sapUiSmallMarginTop"
                    inset="false"
                >
                    <columns>
                        <Column>
                            <Text text="Item" />
                        </Column>
                        <Column hAlign="Center">
                            <Text text="Qty" />
                        </Column>
                        <Column hAlign="End">
                            <Text text="Price" />
                        </Column>
                        <Column hAlign="End">
                            <Text text="Total" />
                        </Column>
                        <Column width="3rem" />
                    </columns>

                    <items>
                        <ColumnListItem>
                            <cells>
                                <Text text="{so>name}" />

                                <!-- EDITABLE QTY -->
                                <Input
                                    value="{so>qty}"
                                    type="Number"
                                    width="4rem"
                                    liveChange="onQtyChange"
                                />

                                <Text text="{so>price}" />

                                <ObjectNumber
                                    number="{so>total}"
                                    unit="₹"
                                />

                                <!-- DELETE ITEM -->
                                <Button
                                    icon="sap-icon://delete"
                                    type="Transparent"
                                    press="onRemoveItem"
                                />
                            </cells>
                        </ColumnListItem>
                    </items>
                </Table>
            </VBox>

            <beginButton>
                <Button
                    text="Save"
                    type="Emphasized"
                    press="onSaveSO"
                />
            </beginButton>

            <endButton>
                <Button
                    text="Cancel"
                    press="onCancelSO"
                />
            </endButton>
        </Dialog>
    </Page>
</mvc:View>
